<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenAI - Wilson Organization</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-green: #1abc9c;
            --dark-green: #16a085;
            --light-green: #2ecc71;
            --primary-blue: #3498db;
            --dark-blue: #2980b9;
            --light-gray: #ecf0f1;
            --dark-gray: #34495e;
            --text-color: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: url('image/greenforest.png') no-repeat center center fixed;
            background-size: cover;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(26, 188, 156, 0.95);
            color: white;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            width: 45px;
            height: 45px;
            background: url('image/logo.png') no-repeat center center;
            background-size: contain;
            border-radius: 50%;
            background-color: white;
            padding: 3px;
        }
        
        .header-title {
            font-size: 1.6rem;
            font-weight: bold;
            letter-spacing: 0.5px;
        }
        
        .header-org {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            padding: 15px;
            gap: 15px;
            position: relative;
        }
        
        .sidebar {
            width: 280px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            transition: transform 0.3s ease;
        }
        
        .session-info {
            padding: 15px;
        }
        
        .session-id {
            font-size: 0.8rem;
            margin-bottom: 15px;
            word-break: break-all;
            background: rgba(0, 0, 0, 0.05);
            padding: 10px;
            border-radius: 8px;
        }
        
        .btn {
            padding: 12px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary-green);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: hidden;
            min-width: 0;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 18px;
            line-height: 1.5;
            position: relative;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            align-self: flex-end;
            background: var(--primary-blue);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .ai-message {
            align-self: flex-start;
            background: var(--light-gray);
            color: var(--text-color);
            border-bottom-left-radius: 5px;
        }
        
        .message-info {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .chat-input-container {
            display: flex;
            gap: 12px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .chat-input {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            resize: none;
            max-height: 150px;
            overflow-y: auto;
            font-size: 1rem;
        }
        
        .send-btn {
            padding: 12px;
            border: none;
            border-radius: 50%;
            background: var(--primary-green);
            color: white;
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .send-btn:hover {
            background: var(--dark-green);
            transform: rotate(15deg);
        }
        
        .typing-indicator {
            display: none;
            padding: 12px 20px;
            background: var(--light-gray);
            border-radius: 18px;
            align-self: flex-start;
            margin-bottom: 15px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        .typing-dots {
            display: flex;
            gap: 5px;
        }
        
        .dot {
            width: 10px;
            height: 10px;
            background: var(--dark-gray);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 100% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 1; }
        }
        
        .tools-container {
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .tool-btn {
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: var(--primary-blue);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .tool-btn:hover {
            background: var(--dark-blue);
            transform: translateX(5px);
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        /* Мобильная адаптация */
        @media (max-width: 968px) {
            .mobile-menu-btn {
                display: block;
            }
            
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                z-index: 101;
                transform: translateX(-100%);
                background: white;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-container {
                padding: 10px;
            }
            
            .chat-container {
                padding: 15px 10px;
            }
            
            .message {
                max-width: 90%;
            }
        }
        
        @media (max-width: 576px) {
            .header-title {
                font-size: 1.3rem;
            }
            
            .logo {
                width: 40px;
                height: 40px;
            }
            
            .message {
                max-width: 95%;
                padding: 12px 15px;
            }
        }
        
        /* Анимация появления сообщений */
        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message {
            animation: messageAppear 0.3s ease;
        }

        .math-result {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            border-left: 3px solid var(--primary-green);
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo"></div>
            <div>
                <div class="header-title">GreenAI</div>
                <div class="header-org">Wilson Organization</div>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <aside class="sidebar glass-effect" id="sidebar">
            <div class="session-info">
                <h3>Текущая сессия</h3>
                <div class="session-id" id="sessionId">Загрузка...</div>
                <button class="btn btn-danger" id="clearSessionBtn">
                    <i class="fas fa-trash"></i> <span>Удалить историю</span>
                </button>
            </div>
            
            <div class="tools-container">
                <button class="tool-btn" id="newChatBtn">
                    <i class="fas fa-plus"></i> <span>Новый чат</span>
                </button>
                <button class="tool-btn" id="exportChatBtn">
                    <i class="fas fa-download"></i> <span>Экспорт чата</span>
                </button>
            </div>
        </aside>
        
        <main class="chat-container glass-effect">
            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    <div>Приветствую! Я GreenAI, ваш помощник в мире Greenwel RP. Чем могу помочь?</div>
                    <div class="message-info">
                        <span>GreenAI</span>
                        <span>только что</span>
                    </div>
                </div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <textarea class="chat-input" id="chatInput" placeholder="Введите ваше сообщение..." rows="1"></textarea>
                <button class="send-btn" id="sendBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </main>
    </div>
    
    <div class="overlay" id="overlay"></div>

    <script>
        // База знаний GreenAI - вопросы и ответы
        const knowledgeBase = {
            "что такое гринвель рп": "Гринвель РП – это ролевая игра в страны, где можно проявить свои лидерские качества или создать свою страну и историю.",
            "как вступить в гринвель": "Для вступления в ролевую игру нужно использовать бота @Greenwelbot.",
            "анкета страны": "Для анкеты страны используется хештег #анкета для страны. Нужно заполнить: Название страны, Столица, Численность населения, Бюджет, Численность армии, Количество танков, Количество вертолётов, Количество флота, Количество БТР, Количество истребителей, Президент, Валюта, Религия, Язык, Флаг, Фото президента, Ссылка на телеграм канал страны.",
            "население страны": "Численность населения страны должна быть в диапазоне от 1.000 до 5.000.000 человек.",
            "бюджет страны": "Бюджет страны должен быть в диапазоне от 10 миллиардов до 35 миллиардов.",
            "армия страны": "Численность армии может быть от 0 до 75.000 солдат.",
            "танки страны": "Страна может иметь от 0 до 250 танков.",
            "вертолеты страны": "Страна может иметь от 0 до 75 вертолётов.",
            "флот страны": "Количество кораблей флота может быть от 0 до 205 единиц.",
            "бтр страны": "Страна может иметь от 0 до 225 бронетранспортёров (БТР).",
            "истребители страны": "Страна может иметь от 0 до 50 истребителей.",
            "запрещено в анкете": "В анкете страны запрещены реальные компании.",
            "механика игры за компанию": "Игра за компанию находится в бета-тесте, на данный момент есть множество недочётов и проблем.",
            "анкета компании": "Для анкеты компании используется хештег #Анкета для компании. Нужно указать: Название компании, Общий бюджет, Штат сотрудников, Основную миссию / направление деятельности, Генерального директора, Логотип компании, Фотографию руководителя, Ссылку на телеграм-канал компании.",
            "бюджет компании": "Общий бюджет компании должен быть в диапазоне от 1 до 500.000 единиц.",
            "сотрудники компании": "Штат сотрудников компании может быть от 1 до 500 человек.",
            "что дает компания": "Играя за компанию (Т.О.), игрок также получает возможность играть за бандитов и мафиозную группировку, которые находятся под контролем этой компании.",
            "анкета то": "Для анкеты Т.О. используется хештег #анкета для Т.О.. Нужно заполнить: Название организации, Количество бюджета, Численность войск, Количество танков, Количество вертолётов, Количество БТР, Количество беспилотников, Количество машин, ФИО Главы, Флаг, Фото главы, Цель, Религию, Ссылку на телеграм-канал Т.О.",
            "бюджет то": "Бюджет Т.О. должен быть в диапазоне от 100.000 до 15 миллионов единиц.",
            "армия то": "Численность войск Т.О. может быть от 100 до 15.000 человек.",
            "танки то": "Т.О. может иметь от 0 до 40 танков.",
            "вертолеты то": "Т.О. может иметь от 0 до 10 вертолётов.",
            "бтр то": "Т.О. может иметь от 0 до 50 бронетранспортёров.",
            "беспилотники то": "Т.О. может иметь от 0 до 30 беспилотников.",
            "машины то": "Т.О. может иметь от 0 до 65 машин.",
            "анкета чвк": "Для анкеты ЧВК используется хештег #анкета для военного ЧВК.",
            "отличие чвк от то": "Анкета ЧВК имеет другие лимиты на технику и бюджет, а также вместо полей 'Цель' и 'Религия' есть поле 'Основная цель'.",
            "бюджет чвк": "Бюджет ЧВК должен быть в диапазоне от 200.000 до 55 миллионов единиц.",
            "армия чвк": "ЧВК может иметь от 1000 до 10.000 солдат.",
            "танки чвк": "ЧВК может иметь от 0 до 50 танков.",
            "вертолеты чвк": "ЧВК может иметь от 0 до 25 вертолётов.",
            "бтр чвк": "ЧВК может иметь от 0 до 85 бронетранспортёров.",
            "беспилотники чвк": "ЧВК может иметь от 0 до 40 беспилотников.",
            "машины чвк": "ЧВК может иметь от 0 до 75 машин.",
            "токсичность наказание": "Мут до 1 дня или варн.",
            "правило 1.2": "Запрещено поднимать политические и религиозные споры, провоцировать и оскорблять религию, что может задеть игрока.",
            "наказание правило 1.2": "Мут до 2-х дней или варн.",
            "правило 1.3": "Реклама других проектов без разрешения администрации.",
            "наказание правило 1.3": "Мут до недели или 2 варна.",
            "правило 1.4": "Запрещены угрозы докса, деанона и свата, а также распространение вредоносного ПО.",
            "наказание правило 1.4": "Мут до 4-х недель или бан.",
            "правило 1.5": "Запрещено любое упоминание родословной игрока в плохих смыслах.",
            "наказание правило 1.5": "Мут до недели или 2 варна.",
            "нон-рп поведение": "Это поведение, выходящее за рамки ролевой игры, не соответствующее игровой реальности.",
            "наказание нон-рп": "Мут до недели, отстранение от РП или варн.",
            "правило 1.7": "Запрещены спам и флуд сообщениями, стикерами, гифами, реакциями и т.д.",
            "наказание спам": "Мут до месяца или бан.",
            "правило 1.8": "Запрещено публиковать NSFW контент, сцены насилия и жестокости.",
            "наказание nsfw": "Мут до 4-х месяцев или бан.",
            "правило 1.9": "Запрещено распространять личные данные без разрешения игрока.",
            "наказание личные данные": "Бан или мут до 3-х месяцев.",
            "правило 2.0": "Запрещено специально нарушать правила проекта.",
            "телеграм каналы": "Правило 2.1: частные каналы запрещены, их нужно делать публичными. Если это невозможно, необходимо оставлять ссылку на канал под каждым постом.",
            "метагейм": "Метагейм — это использование в игре информации, которую знает игрок, но не его страна (внеигровой информации). Это запрещено и относится к NON-RP.",
            "автокапитуляция": "Условия автокапитуляции: игрок не участвует в войне в течение 24 часов; вышел из войны и не хочет возвращаться; аннулировал свои территории; передал страну другому игроку; задерживает войну более 2 дней.",
            "обратиться за помощью": "Следует обращаться к сотрудникам с префиксом 'Вердер', 'Механик', 'Админ', 'Модератор' или 'Тех. Админ'.",
            "перенос территорий": "Странам запрещено переносить свои территории. ЧВК и Т.О. могут переносить территории и основаться на новых, но при этом откатывается 50% прогресса.",
            "названия техники": "Если используется ненастоящее название реальной техники, необходимо в конце анкеты уточнить её реальное название во избежание путаницы.",
            "использование ии": "Запрещено использование ИИ для написания ходов в войне, даже для 'улучшения' своего хода. Вердер вправе откатить или пропустить такой ход.",
            "коррупция наказание": "За взятки администратор снимается с должности, а игрок получает бан на 3 месяца (срок может варьироваться в зависимости от ситуации).",
            "сколько сущностей": "Одному игроку запрещено создавать несколько сущностей. Разрешено иметь только одну: либо страну, либо Т.О., либо ЧВК.",
            "стартовое вооружение": "Это вооружение, выдаваемое стране/ЧВК/Т.О. в начале игры. Оно не сильно развито и находится на уровне 1970-1980 годов для баланса.",
            "крупные откаты": "Крупные откаты должны одобряться с уровня администратора 'заместитель'.",
            "нон-рп тайм": "Игрок может использовать НОН-РП тайм только 2 раза за 2 дня. Запрещено уходить в НОН-РП тайм во время войны. При уходе можно передать страну другому игроку или уйти в отпуск, уведомив администрацию.",
            "правила колонизации": "Экспедиция длится 4 дня. Можно колонизировать только 10 провинций. Нельзя передавать колонизации другому игроку. Колонизации не накапливаются. Союзные государства могут колонизировать до 14 клеток. Автономии, протектораты, вассалы не могут колонизировать.",
            "война с afk": "Нужно нарисовать карту, сделать 3 хода, после чего война продолжается без вердера. AFK-статус присваивается, если игрок не активничал неделю, вышел из группы или удалил аккаунт.",
            "администрация чата": "Администрация чата — это команда лиц, назначенных для поддержания порядка, соблюдения правил и развития сообщества.",
            "администрация начала": "Администрация действует на добровольных началах, но обязана соблюдать нормы устава.",
            "устав администрации": "Устав обязателен к исполнению всеми членами администрации.",
            "права администрации": "Администрация имеет право: удалять сообщения, нарушающие правила; выдавать предупреждения и ограничивать/блокировать пользователей; назначать и снимать модераторов; проводить опросы, голосования и мероприятия; интерпретировать спорные ситуации, не описанные в правилах.",
            "обязанности администрации": "Администрация обязана: следить за соблюдением правил всеми участниками; быть вежливыми, сдержанными и беспристрастными; воздерживаться от злоупотребления правами; участвовать в обсуждении изменений в управлении; быстро реагировать на жалобы участников; поддерживать активность и здоровую атмосферу; информировать других админов о важных решениях.",
            "запрещено администрации": "Администрации запрещено: использовать функции для личной выгоды, троллинга или мести; удалять сообщения или блокировать без причин и объяснений; изменять ключевые настройки без согласования с владельцем; пропагандировать личные интересы или проекты; оскорблять участников, даже в ответ на провокации.",
            "назначение администраторов": "Новые администраторы назначаются владельцем чата или заместителем.",
            "снятие администратора": "Администратор может быть снят: по собственному желанию; по решению владельца/заместителя; за грубые нарушения устава; при неактивности более 30 дней.",
            "жалоба на админа": "Жалобу на админа можно подать через @ReportgreenwellADMbot",
            "жалоба на игрока": "Жалобу на игрока можно подать через @ReportPlayerGR_bot",
            "владелец гринвель": "Владелец Гринвель РП - Крутой Висказ",
            "ядерное оружие этапы": "Этапы: 1) Теоретические исследования и проектирование (2-3 года, 250 млн$), 2) Получение делящихся материалов (2 года, 5 млрд$), 3) Создание ядерного заряда (3 года, 100-150 млн$), 4) Испытания и доработка (время не ограничено, 1 млн$), 5) Создание средств доставки (2 года, 200 млн$).",
            "типы ядерных зарядов": "Имплозивный тип (более эффективный, 150 млн$) и пушечный тип (проще, но менее эффективен, 100 млн$).",
            "сокращение времени ядерного оружия": "Наличие научно-технической базы сокращает время на 5 лет и уменьшает затраты вдвое. Внешние ограничения увеличивают время на 2 года и удваивают затраты.",
            "время и стоимость ядерного оружия": "Общее время: 10 лет, затраты: 5,1 млрд$. При наличии научно-технической базы: 5 лет, 2,55 млрд$.",
            "анкета военная техника": "Название, фото, тип (БМП, ОБТ, БТР и т.д.), вес, вооружение, вторичное вооружение, экипаж, тип бронирования, толщина бронирования, макс. скорость по шоссе, макс. скорость по пересечённой местности, дополнительно.",
            "анкета стрелковое оружие": "Название, фото, тип (автомат, пистолет, винтовка и т.д.), патрон, скорострельность, вес, боепитание, прицельная дальность, максимальная дальность, дополнительно.",
            "анкета граната": "Название, фото, тип (противопехотная, оборонительная, противотанковая и т.д.), масса, взрывчатое вещество, масса взрывчатого вещества, механизм детонации, задержка взрывателя.",
            "анкета подводная лодка": "Название, фото, тип (МПЛАТРК, ПЛАРК и т.д.), водоизмещение (надводное и подводное), вооружение, крейсерская скорость (надводная и подводная), макс. глубина погружения, автономность плавания, экипаж, дополнительно.",
            "анкета авиация": "Название, фото, тип (истребитель, штурмовик и т.д.), вооружение, бортовая РЛС/ОЛС, масса, грузоподъёмность, экипаж, поколение (для самолётов), макс. скорость, крейсерская скорость, дополнительно.",
            "анкета баллистическая ракета": "Название, фото, тип (МБР, БР и т.д.), базирование (мобильное, в шахте и т.д.), дальность, количество ступеней, головная часть, масса ракеты, дополнительно.",
            "анкета корабли": "Название, фото, тип (эсминец, крейсер, МРК и т.д.), водоизмещение, вооружение, крейсерская скорость, возможность минирования, экипаж, дополнительно.",
            "анкета комплект снаряжения": "Название, фото, для какого времени года, форма (название, материал, расцветка), шлем/каска (название, материал, класс защиты, возможность использования аксессуаров), бронежилет (название, материал, класс защиты, возможность установки плит, подсумки, расцветка), разгрузка (название, материал, расцветка, подсумки), вещевой мешок (название, материал, расцветка, вместимость), предназначение (для инженеров, стрелков и т.д.), дополнительно.",
            "игровое время": "1 игровой год равен 3 реальным дням. Время исчисляется по МСК. Год разделен на 3 фазы по 4 месяца, каждый месяц соответствует 6 часам реального времени.",
            "фазы времени": "1/3 фаза: Январь (0:00-6:00), Февраль (6:00-12:00), Март (12:00-18:00), Апрель (18:00-0:00); 2/3 фаза: Май (0:00-6:00), Июнь (6:00-12:00), Июль (12:00-18:00), Август (18:00-0:00); 3/3 фаза: Сентябрь (0:00-6:00), Октябрь (6:00-12:00), Ноябрь (12:00-18:00), Декабрь (18:00-0:00)",
            "этапы колонизации": "Этапы: 1) Определение цели колонизации, 2) Выполнение предусловий (исследование региона, доступ к ресурсам), 3) Отправка экспедиции, 4) Основание колонии, 5) Взаимодействие с коренными народами.",
            "взаимодействие с коренными народами": "Дипломатия (договоры, союзы, обмен), ассимиляция или вытеснение, конфликт (войны, восстания, террор).",
            "щит новичка": "Это защита на 7 дней для новой страны/ЧВК/Т.О., во время которой на них нельзя нападать. Щит снимается, если игрок сам нападает на кого-то.",
            "начало войны": "Необходимо опубликовать РП-пост с объявлением войны (кроме внезапного нападения) и участие администратора 'Вердер'.",
            "ошибки в войне": "Самоверд (игнорирование вердера), игнорирование местности и климата, игнорирование поставок и их уязвимостей.",
            "причины санкций": "За нападение на другого игрока или марионеточное государство, применение запрещённого оружия, отказ от выполнения международных соглашений.",
            "механика санкций": "Нужно написать пост в телеграм-канал государства с указанием затронутых отраслей и причин санкций.",
            "последствия санкций": "Для нарушителя: снижение экономического роста, повышение риска восстаний, потеря торговых партнёров. Для инициатора: потеря торговых партнёров и доходов.",
            "кто создал анкеты": "Анкеты делал Гойдович.",
            "кто тебя создал": "Меня создал Вилсон, чтобы я помогал игрокам.",
            "кто тебя разработал": "Меня разработала Wilson Organization",
            "что такое нон рп" : "нон рп это нереалистичное ведение игры",
            "что такое гринвель рп": "Гринвель РП – это ролевая игра в страны, где можно проявить свои лидерские качества или создать свою страну и историю.",
            "как вступить в гринвель рп": "Для вступления в ролевую игру нужно использовать бота @Greenwelbot.",
            "кто владелец гринвель рп": "Владелец Гринвель РП - Крутой Висказ.",
            "кто тебя разработал": "Меня разработала Wilson Organization.",
            "кто создал анкеты для военной техники": "Анкеты делал Гойдович.",
            "анкета страны" : "Для анкеты страны используется хештег #анкета_для_страны. Поля: Название страны, Столица, Численность населения, Бюджет, Численность армии, Количество танков, Количество вертолётов, Количество флота, Количество БТР, Количество истребителей, Президент, Валюта, Религия, Язык, Флаг, Фото президента, Ссылка на телеграм канал страны.",
            "население страны": "Численность населения страны должна быть в диапазоне от 1.000 до 5.000.000 человек.",
            "бюджет страны": "Бюджет страны должен быть в диапазоне от 10 миллиардов до 35 миллиардов.",
            "армия страны": "Численность армии может быть от 0 до 75.000 солдат.",
            "танки страны": "Страна может иметь от 0 до 250 танков.",
            "вертолёты страны": "Страна может иметь от 0 до 75 вертолётов.",
            "флот страны": "Количество кораблей флота может быть от 0 до 205 единиц.",
            "бтр страны": "Страна может иметь от 0 до 225 бронетранспортёров (БТР).",
            "истребители страны": "Страна может иметь от 0 до 50 истребителей.",
            "анкета компании": "Для анкеты компании используется хештег #Анкета_для_компании. Поля: Название компании, Общий бюджет, Штат сотрудников, Основную миссию / направление деятельности, Генерального директора, Логотип компании, Фотографию руководителя, Ссылку на телеграм-канал компании.",
            "бюджет компании": "Общий бюджет компании должен быть в диапазоне от 1 до 500.000 единиц.",
            "штат компании": "Штат сотрудников компании может быть от 1 до 500 человек.",
            "анкета то": "Для анкеты Т.О. используется хештег #анкета_для_Т.О. Поля: Название организации, Количество бюджета, Численность войск, Количество танков, Количество вертолётов, Количество БТР, Количество беспилотников, Количество машин, ФИО Главы, Флаг, Фото главы, Цель, Религию, Ссылку на телеграм-канал Т.О.",
            "бюджет то": "Бюджет Т.О. должен быть в диапазоне от 100.000 до 15 миллионов единиц.",
            "армия то": "Численность войск Т.О. может быть от 100 до 15.000 человек.",
            "танки то": "Т.О. может иметь от 0 до 40 танков.",
            "вертолёты то": "Т.О. может иметь от 0 до 10 вертолётов.",
            "бтр то": "Т.О. может иметь от 0 до 50 бронетранспортёров.",
            "беспилотники то": "Т.О. может иметь от 0 до 30 беспилотников.",
            "машины то": "Т.О. может иметь от 0 до 65 машин.",
            "анкета чвк": "Для анкеты ЧВК используется хештег #анкета_для_военного_ЧВК. Отличается от анкеты Т.О. другими лимитами и вместо полей 'Цель' и 'Религия' есть поле 'Основная цель'.",
            "бюджет чвк": "Бюджет ЧВК должен быть в диапазоне от 200.000 до 55 миллионов единиц.",
            "армия чвк": "ЧВК может иметь от 1000 до 10.000 солдат.",
            "танки чвк": "ЧВК может иметь от 0 до 50 танков.",
            "вертолёты чвк": "ЧВК может иметь от 0 до 25 вертолётов.",
            "бтр чвк": "ЧВК может иметь от 0 до 85 бронетранспортёров.",
            "беспилотники чвк": "ЧВК может иметь от 0 до 40 беспилотников.",
            "машины чвк": "ЧВК может иметь от 0 до 75 машин.",
            "что запрещено в анкете страны": "В анкете страны запрещены реальные компании.",
            "наказание за токсичность": "Мут до 1 дня или варн.",
            "правило 1.2": "Запрещено поднимать политические и религиозные споры, провоцировать и оскорблять религию. Наказание: мут до 2-х дней или варн.",
            "правило 1.3": "Реклама других проектов без разрешения администрации. Наказание: мут до недели или 2 варна.",
            "правило 1.4": "Запрещены угрозы докса, деанона и свата, а также распространение вредоносного ПО. Наказание: мут до 4-х недель или бан.",
            "правило 1.5": "Запрещено любое упоминание родословной игрока в плохих смыслах. Наказание: мут до недели или 2 варна.",
            "нарушение рп (нон-рп)": "Поведение, выходящее за рамки ролевой игры. Наказание: мут до недели, отстранение от РП или варн.",
            "правило 1.7": "Запрещены спам и флуд. Наказание: мут до месяца или бан.",
            "правило 1.8": "Запрещено публиковать NSFW контент, сцены насилия и жестокости. Наказание: мут до 4-х месяцев или бан.",
            "правило 1.9": "Запрещено распространять личные данные без разрешения игрока. Наказание: бан или мут до 3-х месяцев.",
            "правило 2.0": "Запрещено специально нарушать правила проекта.",
            "правило про телеграм каналы": "Частные каналы запрещены, их нужно делать публичными. Если это невозможно, необходимо оставлять ссылку на канал под каждым постом.",
            "метагейминг": "Использование в игре информации, которую знает игрок, но не его персонаж (внеигровой информации). Запрещено и относится к NON-RP.",
            "коррупция в администрации": "За взятки администратор снимается с должности, а игрок получает бан на 3 месяца (срок может варьироваться).",
            "сколько сущностей у игрока": "Одному игроку запрещено создавать несколько сущностей. Разрешено иметь только одну: либо страну, либо Т.О., либо ЧВК.",
            "щит новичка": "Защита на 7 дней для новой страны/ЧВК/Т.О., во время которой на них нельзя нападать. Снимается, если игрок сам нападает.",
            "как начать войну": "Необходимо опубликовать РП-пост с объявлением войны (кроме внезапного нападения) и участие администратора 'Вердер'.",
            "автокапитуляция": "Условия: игрок не участвует в войне 24 часа; вышел из войны и не хочет возвращаться; аннулировал территории; передал страну; задерживает войну более 2 дней.",
            "как воевать с afk страной": "Нужно нарисовать карту, сделать 3 хода, после чего война продолжается без вердера. AFK-статус присваивается за неактивность неделю, выход из группы или удаление аккаунта.",
            "игровое время": "1 игровой год = 3 реальным дням по МСК. Год разделен на 3 фазы по 4 месяца, каждый месяц соответствует 6 часам реального времени.",
            "ядерное оружие этапы": "1) Теоретические исследования (2-3 г., 250 млн$), 2) Материалы (2 г., 5 млрд$), 3) Заряд (3 г., 100-150 млн$), 4) Испытания (время не огр., 1 млн$), 5) Средства доставки (2 г., 200 млн$). Итого: 10 лет, 5,1 млрд$.",
            "типы ядерных зарядов": "Имплозивный (150 млн$) и пушечный (100 млн$).",
            "как ускорить создание ядерного оружия": "Научно-техническая база сокращает время на 5 лет и уменьшает затраты вдвое.",
            "колонизация правила": "Экспедиция длится 4 дня. Можно колонизировать только 10 провинций. Нельзя передавать колонизацию. Колонизации не накапливаются. Союзные государства - до 14 клеток. Автономии, протектораты, вассалы не могут колонизировать.",
            "санкции": "Вводятся постом с указанием отраслей и причин. Для нарушителя: снижение экономики, риск восстаний, потеря партнёров. Для инициатора: потеря партнёров и доходов.",
            "стартовое вооружение": "Вооружение, выдаваемое в начале игры. Не сильно развито, на уровне 1970-1980 годов для баланса.",
            "нон-рп тайм": "Можно использовать только 2 раза за 2 дня. Запрещено уходить в НОН-РП тайм во время войны. При уходе можно передать страну или уйти в отпуск, уведомив администрацию.",
            "перенос территорий": "Странам запрещено. ЧВК и Т.О. могут, но при этом откатывается 50% прогресса.",
            "анкеты техники": "Если используется ненастоящее название реальной техники, необходимо в конце анкеты уточнить её реальное название.",
            "использование ии в войне": "Запрещено. Вердер вправе откатить или пропустить такой ход.",
            "кто такая администрация": "Команда лиц, назначенных для поддержания порядка, соблюдения правил и развития сообщества. Действует на добровольных началах.",
            "права администрации": "Удалять сообщения, выдавать предупреждения и муты, назначать модераторов (с уровня 'заместитель'), проводить мероприятия, интерпретировать спорные ситуации.",
            "обязанности администрации": "Следить за правилами, быть вежливыми и беспристрастными, не злоупотреблять правами, участвовать в обсуждениях, быстро реагировать на жалобы, поддерживать активность.",
            "запреты для администрации": "Использовать функции для личной выгоды, удалять сообщения/блокировать без причин, менять настройки без согласования, пропагандировать личные проекты, оскорблять участников.",
            "жалоба на администратора": "Подаётся через @ReportgreenwellADMbot.",
            "жалоба на игрока": "Подаётся через @ReportPlayerGR_bot."
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Элементы DOM
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            const chatMessages = document.getElementById('chatMessages');
            const typingIndicator = document.getElementById('typingIndicator');
            const clearSessionBtn = document.getElementById('clearSessionBtn');
            const sessionIdElement = document.getElementById('sessionId');
            const newChatBtn = document.getElementById('newChatBtn');
            const exportChatBtn = document.getElementById('exportChatBtn');
            const overlay = document.getElementById('overlay');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const sidebar = document.getElementById('sidebar');
            
            // Генерация ID сессии
            let sessionId = localStorage.getItem('greenai_session_id');
            if (!sessionId) {
                sessionId = 'session_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('greenai_session_id', sessionId);
            }
            sessionIdElement.textContent = sessionId;
            
            // Загрузка истории чата
            let chatHistory = JSON.parse(localStorage.getItem(`greenai_chat_${sessionId}`)) || [];
            
            // Восстановление истории чата
            if (chatHistory.length > 0) {
                chatHistory.forEach(msg => {
                    addMessageToChat(msg.text, msg.sender, msg.timestamp, false);
                });
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Функция добавления сообщения в чат
            function addMessageToChat(text, sender, timestamp = new Date(), saveToHistory = true) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
                
                const messageText = document.createElement('div');
                
                // Проверяем, содержит ли сообщение математическое выражение
                const mathResult = evaluateMathExpression(text);
                if (mathResult !== null && sender === 'user') {
                    messageText.innerHTML = `${text}<div class="math-result">= ${mathResult}</div>`;
                } else {
                    messageText.textContent = text;
                }
                
                const messageInfo = document.createElement('div');
                messageInfo.classList.add('message-info');
                
                const senderSpan = document.createElement('span');
                senderSpan.textContent = sender === 'user' ? 'Вы' : 'GreenAI';
                
                const timeSpan = document.createElement('span');
                timeSpan.textContent = formatTime(timestamp);
                
                messageInfo.appendChild(senderSpan);
                messageInfo.appendChild(timeSpan);
                
                messageElement.appendChild(messageText);
                messageElement.appendChild(messageInfo);
                
                chatMessages.appendChild(messageElement);
                
                if (saveToHistory) {
                    chatHistory.push({
                        text,
                        sender,
                        timestamp: timestamp.getTime()
                    });
                    localStorage.setItem(`greenai_chat_${sessionId}`, JSON.stringify(chatHistory));
                }
                
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Форматирование времени
            function formatTime(date) {
                const now = new Date();
                const diff = now - date;
                
                if (diff < 60000) { // Менее минуты
                    return 'только что';
                } else if (diff < 3600000) { // Менее часа
                    const minutes = Math.floor(diff / 60000);
                    return `${minutes} мин. назад`;
                } else if (diff < 86400000) { // Менее суток
                    return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                } else {
                    return date.toLocaleDateString('ru-RU');
                }
            }
            
            // Показать индикатор набора сообщения
            function showTypingIndicator() {
                typingIndicator.style.display = 'block';
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Скрыть индикатор набора сообщения
            function hideTypingIndicator() {
                typingIndicator.style.display = 'none';
            }
            
            // Обработка математических выражений
            function evaluateMathExpression(expression) {
                // Удаляем все пробелы
                expression = expression.replace(/\s/g, '');
                
                // Проверка на процент
                const percentMatch = expression.match(/(\d+)%от(\d+)/i);
                if (percentMatch) {
                    const percent = parseFloat(percentMatch[1]);
                    const number = parseFloat(percentMatch[2]);
                    return (percent / 100) * number;
                }
                
                // Замена ^ на ** для возведения в степень
                expression = expression.replace(/\^/g, '**');
                
                // Проверка на безопасность выражения
                const safeExpression = expression.replace(/[^0-9+\-*/().%]/g, '');
                if (safeExpression !== expression) return null;
                
                try {
                    // Используем Function для вычисления выражения (осторожно!)
                    return Function(`"use strict"; return (${safeExpression})`)();
                } catch (e) {
                    return null;
                }
            }
            
            // Поиск ответа в базе знаний
            function findAnswerInKnowledgeBase(question) {
                const lowerQuestion = question.toLowerCase();
                
                // Ищем точное совпадение
                if (knowledgeBase[lowerQuestion]) {
                    return knowledgeBase[lowerQuestion];
                }
                
                // Ищем по ключевым словам
                const keywords = Object.keys(knowledgeBase);
                for (const keyword of keywords) {
                    if (lowerQuestion.includes(keyword)) {
                        return knowledgeBase[keyword];
                    }
                }
                
                // Если не нашли ответ, возвращаем null
                return null;
            }
            
            // Генерация ответа ИИ
            function generateAIResponse(userMessage) {
                return new Promise((resolve) => {
                    showTypingIndicator();
                    
                    // Имитация задержки ответа
                    const delay = 1000 + Math.random() * 2000;
                    
                    setTimeout(() => {
                        hideTypingIndicator();
                        
                        // Проверка на математические выражения
                        const mathResult = evaluateMathExpression(userMessage);
                        if (mathResult !== null) {
                            resolve(`Результат вычисления: ${mathResult}`);
                            return;
                        }
                        
                        // Поиск ответа в базе знаний
                        const knowledgeAnswer = findAnswerInKnowledgeBase(userMessage);
                        if (knowledgeAnswer) {
                            resolve(knowledgeAnswer);
                            return;
                        }
                        
                        // Общий ответ, если не нашли ответ в базе знаний
                        const generalResponses = [
                            "Интересный вопрос! В контексте Greenwel RP это можно интерпретировать по-разному в зависимости от вашей роли.",
                            "Отличный вопрос! Для уточнения деталей можете посмотреть правила Greenwel RP или обратиться к администрации.",
                            "В мире Greenwel RP это зависит от многих факторов: вашей страны, её союзников, экономического развития и военной мощи.",
                            "Как ИИ помощник, я рекомендую уточнить этот вопрос у администрации проекта, чтобы получить наиболее точный ответ в соответствии с правилами.",
                            "В рамках Greenwel RP это можно реализовать несколькими способами. Какой аспект вас интересует больше?",
                            "Это зависит от конкретных обстоятельств в вашей ролевой игре. Могли бы вы уточнить контекст?",
                            "В Greenwel RP важно соблюдать баланс между реализмом и игровым процессом. Ваш вопрос затрагивает интересный аспект игры!",
                            "Учитывая механику Greenwel RP, это можно реализовать следующим образом...",
                            "Интересная мысль! В рамках проекта это можно обыграть через систему анкет и взаимодействие с другими игроками.",
                            "Как представитель Wilson Organization, я рекомендую ознакомиться с соответствующим разделом правил для точного ответа на ваш вопрос."
                        ];
                        
                        resolve(generalResponses[Math.floor(Math.random() * generalResponses.length)]);
                    }, delay);
                });
            }
            
            // Обработчик отправки сообщения
            sendBtn.addEventListener('click', async function() {
                const message = chatInput.value.trim();
                if (message) {
                    addMessageToChat(message, 'user');
                    chatInput.value = '';
                    chatInput.style.height = 'auto';
                    
                    const response = await generateAIResponse(message);
                    addMessageToChat(response, 'ai');
                }
            });
            
            // Отправка сообщения по Enter
            chatInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendBtn.click();
                }
            });
            
            // Автоматическое изменение высоты textarea
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Очистка истории чата
            clearSessionBtn.addEventListener('click', function() {
                if (confirm('Вы уверены, что хотите удалить всю историю переписки?')) {
                    chatHistory = [];
                    localStorage.removeItem(`greenai_chat_${sessionId}`);
                    chatMessages.innerHTML = '';
                    
                    addMessageToChat('История чата очищена. Чем могу помочь?', 'ai');
                }
            });
            
            // Новый чат
            newChatBtn.addEventListener('click', function() {
                if (confirm('Начать новый чат? Текущая история будет сохранена.')) {
                    sessionId = 'session_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('greenai_session_id', sessionId);
                    sessionIdElement.textContent = sessionId;
                    
                    chatHistory = [];
                    localStorage.removeItem(`greenai_chat_${sessionId}`);
                    chatMessages.innerHTML = '';
                    
                    addMessageToChat('Начата новая сессия. Чем могу помочь?', 'ai');
                }
            });
            
            // Экспорт чата
            exportChatBtn.addEventListener('click', function() {
                const chatText = chatHistory.map(msg => {
                    const sender = msg.sender === 'user' ? 'Вы' : 'GreenAI';
                    const date = new Date(msg.timestamp).toLocaleString('ru-RU');
                    return `[${date}] ${sender}: ${msg.text}`;
                }).join('\n');
                
                const blob = new Blob([chatText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `greenai_chat_${sessionId}.txt`;
                a.click();
                
                URL.revokeObjectURL(url);
            });
            
            // Мобильное меню
            mobileMenuBtn.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
            });
            
            // Закрытие бокового меню при клике на overlay
            overlay.addEventListener('click', function() {
                if (sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    overlay.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>